#!/bin/bash

set -x

if [ $1 == "mfed" ]; then
   source $KUNDB_CONF_DIR/kundb-env.sh
   source $KUNDB_CONF_DIR/mfed_conf.sh
   shardDir=$KUNDB_CONF_DIR
else
   if [ -f "$ROLE_CONF_DIR/kundb-env.sh" ]; then
     source $ROLE_CONF_DIR/kundb-env.sh
     shardDir=$ROLE_CONF_DIR
     if [ $1 == "master" ]; then
        source $ROLE_CONF_DIR/master_conf.sh
     elif [ $1 == "replica" ]; then
        source $ROLE_CONF_DIR/replica_conf.sh
     elif [ $1 == "rdonly" ]; then
        source $ROLE_CONF_DIR/rdonly_conf.sh
     else
        echo "$1 is not exist cant start kundb"
        exit 1
     fi
   else
     echo "$ROLE_CONF_DIR is not exist cant start kundb"
     exit 1
   fi
fi

if [ -f "$shardDir/shard_conf.sh" ]; then
   cd $shardDir && source $shardDir/shard_conf.sh $SHARD_NUM $SHARD_INDEX $UIDBASE  
else
   echo "shard_conf.sh is not exist cant start kundb"
   exit 2
fi


