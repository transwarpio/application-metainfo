---
name: KONG
version: sophonweb-1.2.0-rc5
global: false
namePrefix: Kong
friendlyName: "Kong"
dependencies: []
dockerImage: "transwarp/kong:sophonweb-1.2.0-rc5"
roles:
- name: KONG_SERVER
  friendlyName: "Kong Server"
  labelPrefix: "kong-server"
  linkExpression: "http://${service.roles.KONG_SERVER[0].hostname}:${service['kong.proxy.port']}"
  category: MASTER
  frontendOperations: ["Start", "Stop", "Delete", "Scaleout"]
  env:
  - name: KONG_PROXY_LISTEN
    value: "${service['kong.host']}:${service['kong.proxy.port']}"
  - name: KONG_PROXY_LISTEN_SSL
    value: "${service['kong.host']}:${service['kong.proxy_ssl.port']}"
  - name: KONG_ADMIN_LISTEN
    value: "${service['kong.host']}:${service['kong.admin.port']}"
  - name: KONG_ADMIN_LISTEN_SSL
    value: "${service['kong.host']}:${service['kong.admin_ssl.port']}"
  - name: KONG_DATABASE
    value: mysql
  - name: KONG_MYSQL_HOST
    value: ${service['mysql.host']}
  - name: KONG_MYSQL_PORT
    value: ${service['mysql.port']}
  - name: KONG_MYSQL_PASSWORD
    value: ${service['mysql.password']}
  - name: KONG_MYSQL_USER
    value: ${service['mysql.username']}
  - name: KONG_MYSQL_DATABASE
    value: ${service['kong.mysql.database']}
  - name: KONG_K8S_CLIENT_PORT
    value: ${service['kong.k8s.client.port']}
  mountPaths: []
  resources:
    limitsMemoryKey: server.container.limits.memory
    limitsCpuKey: server.container.limits.cpu
    requestsMemoryKey: server.container.requests.memory
    requestsCpuKey: server.container.requests.cpu
  summaryPolicy: SOME
  mountPaths:
  - mountPath: /var/lib/mysql
    hostPath: /var/${service.sid}/mysql
    name: mysqldata
  autoAssign:
  - advice: !<NumSeq> {"numSeq": [1]}
  suggestion:
  - criteria: !<Range> {"min": 1, "max": 1}
  validation:
  - criteria: !<Range> {"min": 1, "max": 1}
  operations: []

firstWizardConfigs:
- kong.host
- kong.proxy.port
- kong.proxy_ssl.port
- kong.admin.port
- kong.admin_ssl.port
- kong.k8s.client.port
- kong.mysql.database
- mysql.username
- mysql.password
- server.container.limits.memory
- server.container.limits.cpu
- server.container.requests.memory
- server.container.requests.cpu
- server.memory.ratio

healthChecks:
- category: DAEMON_CHECK
  intervalSeconds: 30
  method: !<K8sPod> {}
